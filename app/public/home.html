<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <script src="https://kit.fontawesome.com/8f9e2dfbe3.js" crossorigin="anonymous"></script>


      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700&display=swap" rel="stylesheet">
      <link rel="stylesheet" type="text/css" href="/static/home.css"/>
      <script src="https://code.jquery.com/jquery.js"></script>
      <title>Document</title>
</head>
<body>

     <main class="container">

           <header class="row">
                  <div class="header-logo">
                       <p>slate</p>
                 </div>

                 <span class="header-icon"><i class="fas fa-bars fa-1x"></i></span>

           </header>

           <div class="dashboard">
                 <div class="db-content">
                       
                        <h1 class="db-title">Welcome Back</h1>

                        <section class="data-primary row">

                              <div class="db-data date">
                                    <p id= day-of-week></p>
                                    <p id="day-num"></p>
                              </div>

                              <div class="db-data clock">

                                          <span class="clock-time">
                                          <span id="hours" >00</span ><span>:</span><span id="minutes" >00</span>
                                          </span>

                                          <span class="clock-phase">
                                                <span id="phase"></span>
                                          </span>
                              </div>

                        </section>

                        <section class="db-data tertiary row" id="reservations">

                              <div class="text-content">
                                    <h3 class="data-title">Reservations</h3>
                                    <p class="data-result-primiary">
                                          <span id="table-res-result"></span> Tables Reserved
                                    </p>
                                    <p class="data-result-secondary">
                                          <span id="table-capacity-result"></span>
                                    </p>
                               </div>

                              <img src="static/img/icons/squares-green-ai.png" alt="reservations icon" class="data-icon">
      
                        </section>

                        <section class="db-data tertiary row" id="waitList">

                                    <div class="text-content">
                                          <h3 class="data-title">Waitlist</h3>
                                          <p class="data-result-primiary">
                                                <span id="wait-list-result"></span> Patrons Waiting
                                          </p>
                                          <p class="data-result-secondary">
                                                <span id ="wait-capacity-result"></span></p>
                                    </div>
                                    
                                    <i> <img src="static/img/icons/waitlist-grey-ai.png" alt="reservations icon" class="data-icon"></i>
                                     
                         </section>

                         <nav>
                                    <div class="nav-content row">

                                          <button class="nav-button is-active" id="home"><a href="/"><i class="fas fa-home fa-2x"></i></a></button>

                                          <button class="nav-button" id="reservations"><a href="/tables"><i class="fas fa-th-large fa-2x"></i></a></button>

                                          <button class="nav-button" id="add-res"><a href="/reserve"><i class="fas fa-plus-square fa-2x"></i></i></a></button>
                                          
                                    </div>
                        </nav>
               </div>
            </div>
      </main>

     
</body>

<script>

function runTableQuery(){
      var currentURL = window.location.origin;

      $.ajax({
            url: currentURL + '/api/tables',
            method: "GET"
      }).done(function(tableData){

            console.log("-------------------")
                  console.log("URL: " + currentURL + "/api/tables")
                  console.log("-------------------")
                  console.log("Table Data: ", tableData)
                  console.log("TableArray.Length", tableData.tableArray.length)
                  console.log("-------------------")

                  let tableCapacity = tableData.capacity;
                  let tableBooked = tableData.tableArray.length;

                         $('#table-res-result').append(tableBooked)
                         $('#table-capacity-result').append(tableBooked + "/" + tableCapacity)

      })
}

function runWaitQuery(){

      var currentURL = window.location.origin;

      $.ajax({
            url: currentURL + '/api/waitlist',
            method: "GET"
      }).done(function(waitListData){
            console.log("-------------------")
                  console.log("URL: " + currentURL + "/api/waitlist")
                  console.log("-------------------")
                  console.log("Table Data: ", waitListData)
                  console.log("-------------------")

                  let waitCapacity = waitListData.capacity;
                  let waitBooked = waitListData.waitingArray.length;

                  $('#wait-list-result').append(waitBooked)
                  $('#wait-capacity-result').append(waitBooked + "/" + waitCapacity)

      })
}

runTableQuery()
runWaitQuery()
     

const date = new Date()
let day;
let dayInput = date.getDay()

const dateObj = {
      date: date.getDate(),
}

function getDayOfWeek(){

      switch (dayInput) {
      case 0:
            day = "SUN";
            break;
      case 1:
            day = "MON";
            break;
      case 2:
            day = "TUE";
            break;
      case 3:
            day = "WED";
            break;
      case 4:
            day = "THU";
            break;
      case 5:
            day = "FRI";
            break;
      case  6:
            day = "SAT";
      }

      dateObj.dayOfWeek = day;

      console.log(dateObj)
}

     
function printDateData(){

      const dayTarget = $("#day-of-week")
      const dateTarget = $("#day-num")

      dayTarget.append(dateObj.dayOfWeek)
      dateTarget.append(dateObj.date)

}


function clock() {
    var hours = document.getElementById("hours");
    var minutes = document.getElementById("minutes");
    var phase = document.getElementById("phase");

    var h = new Date().getHours();
    var m = new Date().getMinutes();
    var am = "AM";

    if (h > 12) {
        h = h - 12;
        var am = "PM";
    }

    h = h < 10 ? "0" + h : h;
    m = m < 10 ? "0" + m : m;

    hours.innerHTML = h;
    minutes.innerHTML = m;
    phase.innerHTML = am;
}

var interval = setInterval(clock, 1000);


getDayOfWeek();
clock()
printDateData();



</script>
</html>