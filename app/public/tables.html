<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <script src="https://code.jquery.com/jquery.js"></script>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
      <title>Tables</title>
</head>
<body>

      <div class="container">

            <div class="container p-5 bg-light">

                  <h1 class="text-center fs-1 fw-bold mb-3"><span><i class="bi bi-lightning"></i></span>Hot Restaurant</h1>

                  <h2 class="text-center fs-4 mb-1">Current Reservations and Waiting List</h2>
                  <br>

                  <div class="text-center">
                        <a href="/reserve"><button type="button" class="btn btn-lg btn-danger"><span><i class="bi bi-credit-card-2-back-fill"></i></span>  Make Reservation</button></a>

                        <a href="/"><button type="button" class="btn btn-lg border"><span><i class="bi bi-house-door-fill"></i></i></span> </button></a>
                  </div>
            </div>

            <!--Current Tables -->
            <div class="card my-4">
                  <div class="card-header"> 
                        <h4>Current Reservations</h4>
            </div>
                   <div class="card-body" id="tableSelection">
                  </div>
            </div>

            <!--Waiting List -->
            <div class="card my-4">
                  <div class="card-header"> 
                        <h4>Waiting List</h4>
            </div>
                  <div class="card-body" id= "waitSelection">
                  </div>
            </div>

            <footer>
                  <container>
                        <a href ="/api/clear" id='clear'>Clear Tables</a>
                  </container>
            </footer>

      </div>
</body>
<script type="text/javascript">

      function runTableQuery(){
            var currentURL = window.location.origin;
      
            $.ajax({
                  url: currentURL + '/api/tables',
                  method: "GET"
            })
            .done(function(tableData){
                  console.log("-------------------")
                  console.log("URL: " + currentURL + "/api/tables")
                  console.log("-------------------")
                  console.log(tableData)
                  console.log("-------------------")


                  for(var i =0; i < tableData.length; i++){

                        console.log("Loop Data: ", tableData[i])

                        var tableSelection = $('<div>');
                        tableSelection.addClass('res container bg-light');
                        tableSelection.attr('id', 'tableRes-' + i+1);
                        $('#tableSelection').append(tableSelection)

                        var tableNumber  =  i  +  1;
                        $('#tableRes-' + i+1).append('<h5><span class="badge bg-primary"> '+ tableNumber + '</span> | ' + tableData[i].customerID + '</h5>' )
                  }
            })
      }

      function runWaitQuery(){

            var currentURL = window.location.origin;

            $.ajax({
                  url: currentURL + '/api/waitlist',
                  method: "GET"
            })
            .done(function(waitListData){

                  console.log("-------------------")
                  console.log("URL: " + currentURL + "/api/waitlist")
                  console.log("-------------------")
                  console.log("waitListData: ", waitListData)
                  console.log("-------------------")

                  for(var i = 0; i < waitListData.length; i++){

                        console.log(waitListData[i])

                        var waitSelection = $('<div>');
                        waitSelection.addClass('wait container bg-light');
                        waitSelection.attr('id', 'waitRes-' + i +1)
                        $('#waitSelection').append(waitSelection)

                        var waitingNum = i + 1;
                        $('#waitRes-' + i+1).append('<h5><span class="badge bg-primary">' + waitingNum + '</span> | ' + waitListData[i].customerID + '</h5>');
                        }
            })
      }

      function clearTable() {
      $.ajax({ url: "/api/clear", method: "POST" }).then(function() {
      $("#waitList").empty();
      $("#tableList").empty();
    });
  }

 $('#clear').on('click', function(){
       alert('Cleaing...');
       clearTable();
       loaction.reload()
 })

runTableQuery()
runWaitQuery()


      </script>
</html>